<div class="report-verification-container">
  <div class="report-verification-box">
    <h2>Audit Report Verification</h2>

    <form #reportForm="ngForm" (ngSubmit)="onSubmit(reportForm)" class="report-form">
      <!-- Hidden fields that will be auto-filled -->
      <input type="hidden" name="associated_organization" [(ngModel)]="reportData.associatedOrganization" />
      <input type="hidden" name="associated_application" [(ngModel)]="reportData.associatedApplication" />

      <div class="form-section">
        <!-- Company Name Selection -->
        <div class="form-row">
          <div class="form-group search-dropdown full-width">
            <label for="companySearch">Company Name <span class="required">*</span></label>
            <div class="search-input-wrapper">
              <input style="width: 100%;" id="companySearch" type="text" name="companyName"
                [(ngModel)]="legalEntitySearch" (input)="onClientSearch()" (focus)="showClientDropdown = true"
                (blur)="onClientBlur()" placeholder="Search company name" autocomplete="off" [disabled]="isLoading"
                required #companyNameInput="ngModel" />
            </div>

            <!-- Company Dropdown list -->
            <div class="search-dropdown-list" *ngIf="showClientDropdown && filteredClients.length > 0">
              <div *ngFor="let client of filteredClients" class="dropdown-item" (mousedown)="selectClient(client)"
                [class.selected]="client.clientId === selectedClientId">
                {{ client.legal_entity_name }}
              </div>
            </div>

            <div class="search-dropdown-list"
              *ngIf="showClientDropdown && filteredClients.length === 0 && legalEntitySearch">
              <div class="no-results">No companies found</div>
            </div>


            <!-- Hidden input to store the client ID -->
            <input type="hidden" name="client" [(ngModel)]="selectedClientId" />
          </div>
          <div class="form-group search-dropdown full-width">
            <label for="auditSearch">Assessment / Project Name <span class="required">*</span></label>
            <div class="search-input-wrapper">
              <input style="width: 100%;" id="auditSearch" type="text" name="auditName" [(ngModel)]="auditSearch"
                (input)="onAuditSearch()" (focus)="showAuditDropdown = true" (blur)="onAuditBlur()"
                placeholder="Search audit/project name" autocomplete="off" [disabled]="isLoading || !selectedClientId"
                required #auditNameInput="ngModel" />
            </div>

            <!-- Audit Dropdown list -->
            <div class="search-dropdown-list" *ngIf="showAuditDropdown && filteredAudits.length > 0">
              <div *ngFor="let audit of filteredAudits" class="dropdown-item" (mousedown)="selectAudit(audit)"
                [class.selected]="audit.auditId === selectedAuditId">
                {{ audit.assessment_project_name }}
              </div>
            </div>

            <div class="search-dropdown-list" *ngIf="showAuditDropdown && filteredAudits.length === 0 && auditSearch">
              <div class="no-results" *ngIf="selectedClientId">No audits found for this company</div>
              <div class="no-results" *ngIf="!selectedClientId">Please select a company first</div>
            </div>



            <!-- Hidden input to store the audit ID -->
            <input type="hidden" name="audit" [(ngModel)]="selectedAuditId" />
          </div>
        </div>
      </div>

      <!-- File Upload Section -->
      <div class="form-section">

        <!-- ================= PREVIOUS REPORT ================= -->
        <div class="form-group full-width">
          <p class="report-heading">Previous Report</p>

          <div class="form-row">

            <!-- AOC REPORT -->
            <div class="form-group">
              <label class="sub-label">AOC Report</label>
              <div class="report-file-box">
                <div style="margin-bottom: 10px;">
                  <div *ngFor="let file of previousAocReportFiles; let i = index" class="file-item" style="display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #eee;">
                    <span style="font-size: 12px;">{{ file.name }}</span>
                    <button type="button" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; line-height: 1;" (click)="removeFile('previousAoc', i)">×</button>
                  </div>
                  <div *ngIf="previousAocReportFiles.length === 0" style="color: #666; font-style: italic; padding: 5px 0;">
                    No files selected
                  </div>
                </div>
                <div class="report-buttons single-btn">
                  <button type="button" class="btn-upload" (click)="onUpload('previousAoc')">
                    <span>Upload PDF(s)</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- ROC REPORT -->
            <div class="form-group">
              <label class="sub-label">ROC Report</label>
              <div class="report-file-box">
                <div style="margin-bottom: 10px;">
                  <div *ngFor="let file of previousRocReportFiles; let i = index" class="file-item" style="display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #eee;">
                    <span style="font-size: 12px;">{{ file.name }}</span>
                    <button type="button" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; line-height: 1;" (click)="removeFile('previousRoc', i)">×</button>
                  </div>
                  <div *ngIf="previousRocReportFiles.length === 0" style="color: #666; font-style: italic; padding: 5px 0;">
                    No files selected
                  </div>
                </div>
                <div class="report-buttons single-btn">
                  <button type="button" class="btn-upload" (click)="onUpload('previousRoc')">
                    <span>Upload PDF(s)</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- FINAL REPORT -->
            <div class="form-group">
              <label class="sub-label">Final Report</label>
              <div class="report-file-box">
                <div style="margin-bottom: 10px;">
                  <div *ngFor="let file of previousFinalReportFiles; let i = index" class="file-item" style="display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #eee;">
                    <span style="font-size: 12px;">{{ file.name }}</span>
                    <button type="button" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; line-height: 1;" (click)="removeFile('previousFinal', i)">×</button>
                  </div>
                  <div *ngIf="previousFinalReportFiles.length === 0" style="color: #666; font-style: italic; padding: 5px 0;">
                    No files selected
                  </div>
                </div>
                <div class="report-buttons single-btn">
                  <button type="button" class="btn-upload" (click)="onUpload('previousFinal')">
                    <span>Upload PDF(s)</span>
                  </button>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- ================= CURRENT REPORT ================= -->
        <div class="form-group full-width">
          <p class="report-heading" id="current-report">Current Report</p>

          <div class="form-row">

            <!-- AOC REPORT -->
            <div class="form-group">
              <label class="sub-label">AOC Report</label>
              <div class="report-file-box">
                <div style="margin-bottom: 10px;">
                  <div *ngFor="let file of currentAocReportFiles; let i = index" class="file-item" style="display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #eee;">
                    <span style="font-size: 12px;">{{ file.name }}</span>
                    <button type="button" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; line-height: 1;" (click)="removeFile('currentAoc', i)">×</button>
                  </div>
                  <div *ngIf="currentAocReportFiles.length === 0" style="color: #666; font-style: italic; padding: 5px 0;">
                    No files selected
                  </div>
                </div>
                <div class="report-buttons single-btn">
                  <button type="button" class="btn-upload" (click)="onUpload('currentAoc')">
                    <span>Upload PDF(s)</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- ROC REPORT -->
            <div class="form-group">
              <label class="sub-label">ROC Report</label>
              <div class="report-file-box">
                <div style="margin-bottom: 10px;">
                  <div *ngFor="let file of currentRocReportFiles; let i = index" class="file-item" style="display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #eee;">
                    <span style="font-size: 12px;">{{ file.name }}</span>
                    <button type="button" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; line-height: 1;" (click)="removeFile('currentRoc', i)">×</button>
                  </div>
                  <div *ngIf="currentRocReportFiles.length === 0" style="color: #666; font-style: italic; padding: 5px 0;">
                    No files selected
                  </div>
                </div>
                <div class="report-buttons single-btn">
                  <button type="button" class="btn-upload" (click)="onUpload('currentRoc')">
                    <span>Upload PDF(s)</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- FINAL REPORT -->
            <div class="form-group">
              <label class="sub-label">Final Report</label>
              <div class="report-file-box">
                <div style="margin-bottom: 10px;">
                  <div *ngFor="let file of currentFinalReportFiles; let i = index" class="file-item" style="display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid #eee;">
                    <span style="font-size: 12px;">{{ file.name }}</span>
                    <button type="button" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; line-height: 1;" (click)="removeFile('currentFinal', i)">×</button>
                  </div>
                  <div *ngIf="currentFinalReportFiles.length === 0" style="color: #666; font-style: italic; padding: 5px 0;">
                    No files selected
                  </div>
                </div>
                <div class="report-buttons single-btn">
                  <button type="button" class="btn-upload" (click)="onUpload('currentFinal')">
                    <span>Upload PDF(s)</span>
                  </button>
                </div>
              </div>
            </div>

          </div>
        </div>

      </div>

      <!-- Submit Button -->
      <div class="form-actions">
         <button type="button" class="btn-reset" (click)="resetReoprtForm(reportForm)" [disabled]="isLoading">
            <span>Reset Form</span>
          </button>
        <button type="submit" class="btn-primary" [disabled]="isSubmitting || isLoading">
          <span *ngIf="!isSubmitting">Submit Verification</span>
          <span *ngIf="isSubmitting">Submitting...</span>
        </button>
      </div>
    </form>
  </div>
</div>