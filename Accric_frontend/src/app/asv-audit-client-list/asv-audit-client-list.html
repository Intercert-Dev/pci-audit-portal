<div class="asv-audit-list-container">
  <div class="asv-audit-list-box">
    <div class="header-row">
      <p>ASV Audit List</p>
      <div class="header-right">
        <div class="search-box">
          <img src="/assets/icons/magnifying-glass 2.png" alt="Search Icon">
          <input type="text" placeholder="Search Audits" [(ngModel)]="search_text" (input)="filter_list()">
        </div>
        <button class="export-btn" (click)="exportToExcel()"><span>Export to Excel</span></button>
      </div>
    </div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Associated Organization</th>
            <th>Associated Application</th>
            <th>Number of IP</th>
            <th>IP Details</th>
            <th>Status</th>
            <th>Created Date</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let audit of filtered_list">
            <td>{{ audit.associated_organization || 'N/A' }}</td>
            <td>{{ audit.associated_application || 'N/A' }}</td>
            <td>{{ audit.number_ip || 0 }}</td>
            <td>
              <span class="ip-details" *ngIf="audit.ip_details" (click)="viewAuditDetails(audit)">
                {{ (audit.ip_details.length > 50) ? (audit.ip_details | slice:0:50) + '...' : audit.ip_details }}
              </span>
              <span *ngIf="!audit.ip_details">N/A</span>
            </td>
            <td>
                {{ getStatusLabel(audit.status) || 'N/A' }}
            </td>
            <td>{{ formatDate(audit.created_at) }}</td>
            <td class="sticky-action">
              <div class="action-box">
                <img src="/assets/icons/edit.png" alt="Edit" (click)="editAudit(audit)">
                <!-- <img src="/assets/icons/delete.png" alt="Delete" (click)="deleteAudit(audit)"> -->
              </div>
            </td>
          </tr>
          
          <!-- Loading State -->
          <tr *ngIf="isLoading && filtered_list.length === 0">
            <td colspan="9" style="text-align: center; padding: 20px;">
              Loading ASV audits...
            </td>
          </tr>
          
          <!-- Empty State -->
          <tr *ngIf="!isLoading && filtered_list.length === 0">
            <td colspan="9" style="text-align: center; padding: 20px;">
              No ASV audits found.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Edit ASV Audit Popup -->
<div class="edit-audit-popup-overlay" *ngIf="editingAudit">
  <div class="edit-audit-popup">
    <div class="popup-header">
      <h2>Edit ASV Audit</h2>
      <button class="close-btn" (click)="cancelEdit()">&times;</button>
    </div>

    <div class="popup-content">
      <form #editAuditForm="ngForm">

        <!-- Basic Information Section -->
        <div class="popup-section">
          <h3 class="section-title">Basic Information</h3>
          <div class="form-grid">

          

       

            <div class="form-group">
              <label>Associated Organization</label>
              <input type="text" name="associated_organization" [(ngModel)]="editingAudit.associated_organization"
                placeholder="Associated Organization" readonly />
            </div>

            <div class="form-group">
              <label>Associated Application</label>
              <input type="text" name="associated_application" [(ngModel)]="editingAudit.associated_application"
                placeholder="Associated Application" readonly />
            </div>

                 <div class="form-group">
              <label>Number of IP*</label>
              <input type="number" name="number_ip" required [(ngModel)]="editingAudit.number_ip"
                placeholder="Number of IP" min="0" readonly />
              <small class="hint-text">Auto-calculated from IP details</small>
            </div>

            <div class="form-group full-width">
              <label>IP Details*</label>
              <textarea name="ip_details" required [(ngModel)]="editingAudit.ip_details"
                placeholder="Enter IP addresses (comma separated or one per line)" rows="3"></textarea>
              <small class="hint-text">Enter IP addresses separated by commas or new lines</small>
            </div>

          </div>
        </div>

        <!-- Audit Details Section -->
        <div class="popup-section">
          <h3 class="section-title">Audit Details</h3>
          <div class="form-grid">

            <div class="form-group">
              <label>Audit Status*</label>
              <select name="status" required [(ngModel)]="editingAudit.status">
                <option value="" disabled>Select Status</option>
                <option value="INPROGRESS">In Progress</option>
                <option value="COMPLETED">Completed</option>
                <option value="NOTSTARTED">Not Started</option>
                <option value="PENDING">Pending</option>
              </select>
            </div>

        

          </div>
        </div>

      </form>
    </div>

    <div class="popup-footer">
      <button class="btn-cancel" (click)="cancelEdit()"><span>Cancel</span></button>
      <button class="btn-save" (click)="saveAudit()"><span>Save Changes</span></button>
    </div>
  </div>
</div>
