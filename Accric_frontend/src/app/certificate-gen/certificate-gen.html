<div class="certificate-box">
  <div class="certificate-container" [class.expanded]="showCertificateForm">
    <!-- Certificate input form -->
    <form #certForm="ngForm" (ngSubmit)="generateCertificate(certForm)">
      <div class="input-row">
        <input type="text" name="certificateNo" ngModel required placeholder="Enter certificate number" />
        <button class="certificate-btn" type="submit">
          <span>Generate</span>
        </button>
      </div>
      <div *ngIf="showCertificateForm && certificateData">
        <p class="certificate-sub-heading">Select and Edit Certificate Fields</p>
        <div class="edit-options">
          <div class="fields-container">
            <!-- Certificate No -->
            <div class="field-row">
              <input type="checkbox" [(ngModel)]="editFields.certificateNo" name="certificateNoCheck" />
              <label>Certificate No</label>
              <input type="text" [(ngModel)]="certificateData.certificateNo" name="certificateNo" />
            </div>

            <!-- Company Name -->
            <div class="field-row">
              <input type="checkbox" [(ngModel)]="editFields.companyName" name="companyNameCheck" />
              <label>Company Name</label>
              <input type="text" [(ngModel)]="certificateData.companyName" name="companyName" />
            </div>

            <!-- Full Address -->
            <div class="field-row">
              <input type="checkbox" [(ngModel)]="editFields.full_address" name="full_address_check" />
              <label>Full Address</label>
              <input type="text" [(ngModel)]="certificateData.full_address" name="full_address" (input)="splitAddress()"
                placeholder="Street, City, State, Country, Zip" />
            </div>

            <!-- Date Issue -->
            <div class="field-row">
              <input type="checkbox" [(ngModel)]="editFields.dateIssue" name="dateIssueCheck" />
              <label>Date Issue</label>
              <input type="text" [(ngModel)]="certificateData.dateIssue" name="dateIssue" />
            </div>

            <!-- Date Valid -->
            <div class="field-row">
              <input type="checkbox" [(ngModel)]="editFields.dateValid" name="dateValidCheck" />
              <label>Date Valid</label>
              <input type="text" [(ngModel)]="certificateData.dateValid" name="dateValid" />
            </div>
            <!-- Classification -->
            <div class="field-row">
              <input type="checkbox" [(ngModel)]="editFields.assessment_classification"
                name="assessment_classification" />
              <label>Assessment Classification</label>
              <input type="text" [(ngModel)]="certificateData.assessment_classification"
                name="assessment_classification" />
            </div>

            <!-- Version -->
            <div class="field-row">
              <input type="checkbox" [(ngModel)]="editFields.version" name="versionCheck" />
              <label>Version</label>
              <input type="text" [(ngModel)]="certificateData.version" name="version"
                placeholder="Standard Version 4.0.1" />
            </div>

            <!-- Auditor Name -->
            <div class="field-row">
              <input type="checkbox" [(ngModel)]="editFields.auditor_name" name="auditorNameCheck" />
              <label>Auditor Name</label>
              <select [(ngModel)]="certificateData.auditor_name" name="auditor_name">
                <option value="">-- Select Auditor --</option>
                <option *ngFor="let auditor of auditorList" [value]="auditor">
                  {{ auditor }}
                </option>
              </select>
            </div>

          </div>
        </div>

        <p class="certificate-sub-heading">Certification Option</p>
        <div class="certification-options">
          <div class="options-flex-container">
            <div class="option-row">
              <label>Scope Font Size</label>
              <select [(ngModel)]="certificateOptions.scopeFontSize" name="scopeFontSize">
                <option *ngFor="let size of fontSizes" [value]="size">{{size}}</option>
              </select>
            </div>

            <div class="option-row">
              <label>Table Font Size</label>
              <select [(ngModel)]="certificateOptions.tableFontSize" name="tableFontSize">
                <option *ngFor="let size of tableFontSizes" [value]="size">{{size}}</option>
              </select>
            </div>

            <div class="option-row">
              <label>Page Size</label>
              <select [(ngModel)]="certificateOptions.pageSize" name="pageSize">
                <option *ngFor="let size of pageSizes" [value]="size">{{size}}</option>
              </select>
            </div>

            <div class="option-row">
              <label>Type</label>
              <select [(ngModel)]="certificateOptions.type" name="type">
                <option value="">-- Select Type --</option>
                <option *ngFor="let t of certificateTypes" [value]="t">{{t}}</option>
              </select>
            </div>

            <div class="option-row">
              <label>Certificate Format</label>
              <select [(ngModel)]="certificateOptions.formatType" name="formatType">
                <option value="Softcopy">Softcopy</option>
                <option value="Hardcopy">Hardcopy</option>
              </select>
            </div>

            <div class="option-row checkbox">
              <div class="checkbox-row">
                <label>
                  <input type="checkbox" [(ngModel)]="certificateOptions.includeLineBreak" name="includeLineBreak">
                  Include line break before version
                </label>
              </div>

              <div class="checkbox-row">
                <label>
                  <input type="checkbox" [(ngModel)]="certificateOptions.showValidityLine" name="showValidityLine">
                  Show validity line
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div class="btn-certificate">
          <button class="certificate-btn" type="button" (click)="generateCertificatePdf()" >
            <span>Generate Certificate</span>
          </button>
        </div>
      </div>
    </form>
  </div>
  <!-- PDF Viewer Section (OUTSIDE the form) -->
  <div *ngIf="showPdfViewer" #pdfViewer class="pdf-viewer-container">
    <div class="pdf-viewer-header">
      <h3>Certificate Preview</h3>
      <div class="pdf-viewer-controls">
        <button class="certificate-btn" (click)="downloadCurrentPDF()">
          <span>Download PDF</span>
        </button>
        <button class="certificate-btn" (click)="printPDF()">
          <span>Print PDF</span>
        </button>
        <button class="certificate-btn btn-close" (click)="closePdfViewer()">
          <span>Close</span>
        </button>
      </div>
    </div>

    <div class="pdf-viewer">
      <iframe *ngIf="pdfUrl" [src]="pdfUrl" width="100%" height="600px"
        style="border: 1px solid #ddd; border-radius: 4px;" title="Certificate PDF">
        Your browser does not support PDF viewing.
        Please <a href="javascript:void(0)" (click)="downloadCurrentPDF()">download the PDF</a> instead.
      </iframe>

      <div *ngIf="!pdfUrl" class="pdf-loading">
        <p>Loading PDF...</p>
      </div>
    </div>
  </div>
</div>
  