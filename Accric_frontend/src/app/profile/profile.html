<div class="profile-page">
  <div class="profile-wrapper">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading profile data...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !isLoading" class="error-state">
      <div class="error-icon">‚ö†Ô∏è</div>
      <p class="error-message">{{ errorMessage }}</p>
      <button class="btn-retry" (click)="refreshProfile()">Retry</button>
    </div>

    <!-- PROFILE CARD -->
    <div *ngIf="!isLoading && !errorMessage" class="profile-card">
      <header class="profile-header">
        <div class="avatar-wrapper">
          <img [src]="userProfile.avatarUrl" 
               [alt]="userProfile.name" 
               class="profile-avatar"
               (error)="userProfile.avatarUrl = 'https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg'" />
        </div>

        <h1 class="profile-name">{{ userProfile.name }}</h1>
        <p class="profile-role">{{ userProfile.role || userProfile.title }}</p>

        <div class="footer">
          <section class="contact-section">
            <h2 class="section-title">Contact & Location</h2>

            <div class="info-grid">
              <div class="info-item">
                <i class="icon fas fa-envelope"></i>
                <span>{{ userProfile.email || 'Not provided' }}</span>
              </div>

              <div class="info-item">
                <i class="icon fas fa-phone"></i>
                <span>{{ userProfile.phone || 'Not provided' }}</span>
              </div>

              <div class="info-item">
                <i class="icon fas fa-map-marker-alt"></i>
                <span>{{ userProfile.location || 'Not provided' }}</span>
              </div>
            </div>
          </section>
          
          <button class="edit-btn" (click)="openEditPopup()">
            <span>Edit Profile</span>
          </button>
        </div>
      </header>
    </div>
  </div>
</div>

<!-- Edit Profile Popup -->
<div class="edit-profile-popup-overlay" *ngIf="showPopup">
  <div class="edit-profile-popup">
    <div class="popup-header">
      <h2>Edit Profile</h2>
      <button class="close-btn" (click)="closeEditPopup()">&times;</button>
    </div>

    <div class="popup-content">
      <form #editProfileForm="ngForm">
        
        <!-- Profile Image Section -->
        <div class="popup-section">
          <h3 class="section-title">Profile Image</h3>
          <div class="profile-image-upload">
            <div class="current-avatar">
              <img [src]="tempData.avatarUrl" 
                   (error)="tempData.avatarUrl = 'https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg'"
                   class="profile-avatar-preview" 
                   alt="Current Avatar">
              <div *ngIf="imageUploading" class="image-uploading">
                <div class="upload-spinner"></div>
                <span>Processing image...</span>
              </div>
            </div>
            <div class="upload-controls">
              <label class="file-upload-btn">
                <input type="file" (change)="onImageUpload($event)" accept="image/*" hidden>
                <span class="upload-icon">üìÅ</span>
                Upload New Photo
              </label>
              <small class="file-hint">Max size: 5MB (JPG, PNG, GIF)</small>
            </div>
          </div>
        </div>

        <!-- Personal Information Section -->
        <div class="popup-section">
          <h3 class="section-title">Personal Information</h3>
          <div class="form-grid">
            
            <div class="form-group">
              <label>Full Name*</label>
              <input type="text" 
                     name="name" 
                     required 
                     [(ngModel)]="tempData.name" 
                     class="form-input"
                     placeholder="Enter your full name"
                     [disabled]="isSaving" />
            </div>

            <div class="form-group">
              <label>Email Address*</label>
              <input type="email" 
                     name="email" 
                     required 
                     [(ngModel)]="tempData.email" 
                     class="form-input"
                     placeholder="Enter your email address"
                     [disabled]="isSaving" />
            </div>

            <div class="form-group">
              <label>Phone Number</label>
              <input type="text" 
                     name="phone" 
                     [(ngModel)]="tempData.phone" 
                     class="form-input"
                     placeholder="Enter your phone number"
                     [disabled]="isSaving" />
            </div>

            <div class="form-group">
              <label>Location</label>
              <input type="text" 
                     name="location" 
                     [(ngModel)]="tempData.location" 
                     class="form-input"
                     placeholder="Enter your location"
                     [disabled]="isSaving" />
            </div>

            <!-- Role/Title (Read-only since it comes from backend) -->
            <div class="form-group">
              <label>Role</label>
              <input type="text" 
                     name="role" 
                     [value]="tempData.role || tempData.title"
                     class="form-input"
                     placeholder="Role"
                     disabled />
              <small class="form-hint">Role is assigned by administrator</small>
            </div>

          </div>
        </div>

        <!-- Save Status Messages -->
        <div *ngIf="saveSuccess" class="save-success">
          <span class="success-icon">‚úì</span>
          <span>Profile updated successfully!</span>
        </div>
        
        <div *ngIf="saveError" class="save-error">
          <span class="error-icon">‚ö†Ô∏è</span>
          <span>{{ saveError }}</span>
        </div>

      </form>
    </div>

    <div class="popup-footer">
      <button class="btn-cancel" type="button" (click)="closeEditPopup()" [disabled]="isSaving">
        <span>Cancel</span>
      </button>
      <button class="btn-save" type="button" (click)="saveProfile()" [disabled]="isSaving || !editProfileForm.valid">
        <span *ngIf="!isSaving">Save Changes</span>
        <span *ngIf="isSaving">
          <span class="save-spinner"></span>
          Saving...
        </span>
      </button>
    </div>
  </div>
</div>